function IBS_GCAL_EVENTS(b,h){this.run(b,h)}
(function(b){function h(a,h){var g=this;this.events=[];var k="https://www.googleapis.com/calendar/v3/calendars/"+encodeURIComponent(a.url.trim())+"/events?key="+a.key+"&orderBy=startTime&singleEvents=true";if(3!==a.start.split("-").length)if("now"===a.start)a.start=moment().format("YYYY-MM-DD");else{var e=parseInt(a.start);"NaN"!==e&&(a.start=1>e?moment().subtract(Math.abs(e),"days").format("YYYY-MM-DD"):moment().add(e,"days").format("YYYY-MM-DD"))}k+="&timeMin="+(new Date(a.start)).toISOString();
b.getJSON(k).then(function(e){b.each(e.items,function(b,d){var e="undefined"!==typeof d.start.dateTime?moment(d.start.dateTime):moment(d.start.date);if("undefined"!==typeof d.end.dateTime)var c=moment(d.end.dateTime);else e=moment(d.end.date);g.events.push({source:a,id:b,title:d.summary||"",start:e,end:c,location:"undefined"===typeof d.location?"":d.location,description:"undefined"===typeof d.description?"":d.description,url:"undefined"===typeof d.htmlLink?"":d.htmlLink})});h()})}b(".no-click").on("click",
"",{},function(a){a.preventDefault()});IBS_GCAL_EVENTS.prototype.run=function(a,t){function g(){var f=[],c;for(c in p)f=f.concat(p[c].events);f.sort(function(a,b){if(a.start.isSame(b.start))return 0;if(a.start.isAfter(b.start))return 1;if(a.start.isBefore(b.start))return-1});a.descending&&(f=f.reverse());f=f.slice(0,parseInt(a.max));b("#ibs-gcal-events-rows-"+a.id).empty();for(c=0;c<f.length;c++){var d=f[c],e=f[c].source,m=moment()>moment(f[c].start)?"*":"",r=moment(f[c].start).format("ddd MMM Do"),
h=moment(f[c].start).format(a.timeFormat);l="undefined"===typeof f[c].location||null===f[c].location||""===f[c].location?'<span style="visibility:hidden">undefined</span>':"<span>"+f[c].location+"</span>";var g=null,g=e.nolink?b('<a href="#" class="no-click">').html(m+d.title):""!==e.altlink?b("<a>").attr({href:e.altlink+d.id,target:"_blank"}).html(m+d.title):b("<a>").attr({href:d.url,target:"_blank"}).html(m+d.title);b(g).css({width:"200px","text-decoration":"none",padding:"3px",color:e.textColor,
"background-color":e.backgroundColor});b("#ibs-gcal-events-rows-"+a.id).append(b('<tr class="gcal-tr-td">').css({height:"25px",color:e.textColor,"background-color":e.backgroundColor,"text-decoration":"none"}).prop("disabled",m).append(b('<td class="td1 gcal-td">').text(r)).append(b('<td class="td2 gcal-td">').text(h)).append(b('<td class="td3 gcal-td">').append(b(g).css({cursor:"pointer"}).qtip(k(d)))).append(b('<td class="td4 gcal-td">').html(l)))}}function k(b){var c=a.dateFormat+" "+a.timeFormat,
d=a.qtip.title.replace("%title%",b.title),e="";"undefined"!==typeof b.location&&""!==b.location&&(e=a.qtip.location.replace("%location%",b.location));var h="";a.nodesc||"undefined"===typeof b.description||""===b.description||(h=a.qtip.description.replace("%description%",b.description));var g="",g=moment(b.start).format(c)+moment(b.end).format(" - "+a.timeFormat);b.allDay&&(g=moment(b.start).format(a.dateFormat)+"  All day");g=a.qtip.time.replace("%time%",g);return{content:{text:a.qtip.order.replace("%title%",
d).replace("%location%",e).replace("%description%",h).replace("%time%",g)},position:{my:"bottom left",at:"top right"},style:{classes:a.qtip.style+" "+a.qtip.rounded+a.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}}if("undefined"!==typeof a.feeds_set)for(var e=a.feeds_set.split(","),n=1;a.feedCount>=n;n++){var q=n.toString(),d="feed_"+q;-1==e.indexOf(q)&&e.length&&(a.feeds[d].enabled=!1)}"undefined"!==typeof a.max&&(a.max=parseInt(a.max));"undefined"!==
typeof a.height&&"null"!==a.height&&"auto"!==a.height&&a.height&&(a.height=parseInt(a.height));b("#ibs-gcal-events-"+a.id).empty().append(b("<table>").addClass("gcal-event-table").css({layout:"fixed",width:"100%",border:"0"}).append(b("<theader>").append(b('<tr class="gcal-tr-th">').css({"text-align":"center"}).append(b('<th class="th1 gcal-th">').text("Day")).append(b('<th class="th2 gcal-th">').text("Time")).append(b('<th class="th3 gcal-th">').text("Event")).append(b('<th class="th4 gcal-th">').text("Location")))).append(b("<tbody>").attr({id:"ibs-gcal-events-rows-"+
a.id}).css({display:"inline-block",height:a.height,overflow:"auto"}))).append(b('<div id="gcal-legend-list-'+a.id+'" class="gcal-legend"></div>'));a.legend?b("#gcal-legend-list-"+a.id).css({visibility:"visible"}):b("#gcal-legend-list-"+a.id).css({visibility:"hidden"});var p=[],c;for(c in a.feeds)""!==a.feeds[c].url&&a.feeds[c].enabled&&/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a.feeds[c].url)&&(p.push(new h({key:"string"===
typeof a.feeds[c].key&&""!==a.feeds[c].key?a.feeds[c].key:"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc",start:a.start,max:a.max,nolink:a.feeds[c].nolink,nodesc:a.feeds[c].nodesc,altlink:a.feeds[c].altlink,feedName:a.feeds[c].name,textColor:a.feeds[c].textColor,backgroundColor:a.feeds[c].backgroundColor,url:a.feeds[c].url},g)),b("#gcal-legend-list-"+a.id).append(b("<span>").addClass("gcal-legend-color").css({"background-color":a.feeds[c].backgroundColor})).append(b("<span>").addClass("gcal-legend-name").text(a.feeds[c].name)))}})(jQuery);
